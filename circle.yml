machine:
  timezone: Asia/Tokyo
  ruby:
    version: 2.2.3

dependencies:
  cache_directories:
    - node_modules
    - vendor/bundle

checkout:
  post:
    - cp config/secrets.yml.sample config/secrets.yml
    - cp config/database.yml.sample config/database.yml

test:
  pre:
    - RAILS_ENV=test bin/rake npm:install

deployment:
  development:
    branch: release/development
    commands:
      - eval $(ssh-agent) && ssh-add $HOME/.ssh/id_circleci_github && bundle exec cap development deploy

  staging:
    branch: release/staging
    commands:
      - eval $(ssh-agent) && ssh-add $HOME/.ssh/id_circleci_github && bundle exec cap staging deploy

  production:
    branch: release/production
    commands:
      - eval $(ssh-agent) && ssh-add $HOME/.ssh/id_circleci_github && bundle exec cap production deploy
